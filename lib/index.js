!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["tree-graph"]=e():t["tree-graph"]=e()}(window,(function(){return function(t){function e(e){for(var r,a,l=e[0],s=e[1],c=e[2],d=0,f=[];d<l.length;d++)a=l[d],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&f.push(o[a][0]),o[a]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);for(u&&u(e);f.length;)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var t,e=0;e<i.length;e++){for(var n=i[e],r=!0,l=1;l<n.length;l++){var s=n[l];0!==o[s]&&(r=!1)}r&&(i.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},o={1:0},i=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var l=window.webpackJsonptree_graph=window.webpackJsonptree_graph||[],s=l.push.bind(l);l.push=e,l=l.slice();for(var c=0;c<l.length;c++)e(l[c]);var u=s;return i.push([3,0]),n()}([,function(t,e,n){"use strict";n.r(e),n.d(e,"COLLAPSE_ICON",(function(){return r})),n.d(e,"EXPAND_ICON",(function(){return o}));n(4);const r=function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t-n+2*n-4,e]]},o=function(t,e,n){return[["M",t-n,e],["a",n,n,0,1,0,2*n,0],["a",n,n,0,1,0,2*-n,0],["M",t-n+4,e],["L",t-n+2*n-4,e],["M",t-n+n,e-n+4],["L",t,e+n-4]]}},,function(t,e,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var i=o(n(0)),a=n(1),l=n(2),s=n(7),c=n(9);i.default,window.TREE_GRAPH=n(12).version;var u=180,d=38;function f(t,e,n,r){void 0===n&&(n=[]),void 0===r&&(r=0);var o=t._cfg.model;if(o&&void 0!==o.fid)return function t(e,n,r){for(var o=0;o<r.length;o++){var i=r[o],a=i._cfg.model.id,l=e._cfg.model.fid;if(a===l)return void n.push(i);i.children&&i.children.length>0&&t(e,n,i.children)}}(t,n,e),f(n[r],e,n,++r),n}var h=function(){function t(t){var e=t.data,n=t.nodeConfig,r=void 0===n?null:n,o=t.container;c.flowLine(r),s.tableNode(r),this.data=e,this.container=o,r&&(this.nodeConfig=r),this.graph=this.initGraph(arguments[0])}return t.prototype.initGraph=function(t){var e,n=t.data,o=t.layout,s=void 0===o?{}:o,u=this.getCanvasStyle(),d=u.CANVAS_WIDTH,h=u.CANVAS_HEIGHT,g=this.conextMenuContainer=document.createElement("div"),p=this.conextMenuContainerUl=document.createElement("ul");g.id="g6ContextMenu",p.id="g6ContextMenuUl",g.appendChild(p),document.getElementById(this.container).appendChild(g),e=this.graph=new i.default.TreeGraph({container:this.container,width:d,height:h,nodeStateStyles:{highlight:{opacity:1},dark:{opacity:.2}},modes:{default:[{type:"collapse-expand",shouldBegin:function(t){return"collapse-icon"===t.target.get("name")},onChange:function(t,e){console.log("item",t,e),t;var n=t.get("group").find((function(t){return"collapse-icon"===t.get("name")}));e?n.attr("symbol",a.EXPAND_ICON):n.attr("symbol",a.COLLAPSE_ICON)}},"drag-canvas","zoom-canvas"]},defaultNode:{type:"table-node",anchorPoints:[[0,.5],[1,.5]]},defaultEdge:{type:"flow-line",style:c.defaultEdgeStyle},layout:r({type:"compactBox",direction:"LR",getId:function(t){return t.id},getWidth:function(){return 150},getVGap:function(t,e){console.log("data",t,e);var n=l.get(t,"data.node",[]);return n.length>0?30*n.length/2:20},getHGap:function(){return 50}},s),edgeStateStyles:{highlight:{stroke:"#999"}}});var y=null;return e.on("node:mouseenter",(function(t){y=setTimeout((function(){!function(t){var n=t.item;e.setAutoPaint(!1);var r=e.getNodes();r.forEach((function(t){console.log("V0.0.2"),e.clearItemStates(t,"dark"),e.clearItemStates(t,"highlight"),e.setItemState(t,"dark",!0)})),e.setItemState(n,"dark",!1),e.setItemState(n,"highlight",!0);var o=f(n,r);e.getEdges().forEach((function(t){e.clearItemStates(t,"highlight"),e.clearItemStates(t,"dark"),t.getTarget()===n?e.setItemState(t,"highlight",!0):e.setItemState(t,"dark",!0)})),Array.isArray(o)&&o.forEach((function(t){(e.setItemState(t,"highlight",!0),"0"!==t._cfg.model.id)&&t.getEdges().forEach((function(t){t.getTarget()._cfg.model.fid!==n._cfg.model.fid&&e.setItemState(t,"highlight",!0)}))})),e.paint(),e.setAutoPaint(!0)}(t)}),150)})),e.on("node:mouseleave",(function(t){clearTimeout(y),e.setAutoPaint(!1),e.getNodes().forEach((function(t){e.setItemState(t,"highlight",!0)})),e.getEdges().forEach((function(t){e.setItemState(t,"highlight",!0)})),e.paint(),e.setAutoPaint(!0),g.style.display="none"})),e.get("canvas").set("localRefresh",!1),this.render(n),this.autoFix(),e},t.prototype.conextMenuClick=function(t){var e=this,n=this;n.graph.on("node:click",(function(r){if(console.log("evt",r),"ip-cp-icon"===r.target.get("name")){r.preventDefault(),r.stopPropagation(),n.conextMenuContainer.style.left=r.canvasX-u/2+"px",n.conextMenuContainer.style.top=r.canvasY+"px",n.conextMenuContainer.style.display="block",n.conextMenuContainerUl.innerHTML="";var o=r.item._cfg.model.data.conextMenu;Array.isArray(o)&&o.forEach((function(r,i){var a=document.createElement("li");a.style.minWidth=u+"px",a.style.height=d+"px",a.innerText=r.name,a.setAttribute("index",i),a.onclick=function(){var e=n.getAttribute("index");t(o[e])},e.conextMenuContainerUl.appendChild(a)}))}}))},t.prototype.getNodeConfig=function(t){return"function"==typeof this.nodeConfig?this.nodeConfig(t):{basicColor:"#2F54EB",fontColor:"#333333",borderColor:"#02A8F4",bgColor:"white"}},t.prototype.getCanvasStyle=function(){return{CANVAS_HEIGHT:document.getElementById(this.container).offsetHeight,CANVAS_WIDTH:document.getElementById(this.container).offsetWidth}},t.prototype.autoFix=function(){var t,e=this;window.onresize=function(){clearTimeout(t),t=setTimeout((function(){e.changeCanvasSize()}),500)}},t.prototype.changeCanvasSize=function(){var t=this.getCanvasStyle(),e=t.CANVAS_WIDTH,n=t.CANVAS_HEIGHT;this.graph.changeSize(e,n)},t.prototype.render=function(t){this.graph.data(t),this.graph.render(),this.graph.fitCenter()},t}();e.default=h},,,,function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.tableNode=void 0;var o=r(n(0)),i=n(2),a=n(8),l=n(1);e.tableNode=function(t){o.default.registerNode("table-node",{draw:function(e,n){console.log("节点数据",e);var r="#0486FE",o=(e.x,e.y,160),s=i.get(e,"data.node",[]),c=38*(s.length||1),u=n.addShape("rect",{attrs:{x:-80,y:-c/2,width:o,height:c,stroke:r,fill:r},name:"main-box",draggable:!0}),d=[{bg:r,font:"white"},{bg:"white",font:r},{bg:"white",font:r}];function f(t,e){return t+1===s.length?d[2][e]:t?d[1][e]:d[0][e]}return s.forEach((function(e,i){n.addShape("rect",{attrs:{lineWidth:1,x:-80,y:-c/2+38*i,width:o,height:38,fill:f(i,"bg"),stroke:r},name:"title-box",draggable:!0}),s.length-1===i&&(n.addShape("rect",{attrs:{lineWidth:.1,x:64,y:-c/2+38*i,width:16,height:38,fill:"#ABD6FF"},name:"more",draggable:!0}),n.addShape("image",{attrs:{x:64,y:-c/2+38*i+14,width:16,height:16,img:t.icon},name:"image-shape"})),n.addShape("text",{attrs:{x:(i?10:80)-80,y:-c/2+25+38*i,lineHeight:20,textAlign:i?"start":"center",text:a.fittingString(e,s.length-1===i?18:22),fill:f(i,"font")},name:"title"})})),console.log("cfg",e),e.children&&n.addShape("marker",{attrs:{x:80,y:0,r:6,cursor:"pointer",symbol:e.collapsed?l.EXPAND_ICON:l.COLLAPSE_ICON,stroke:"#666",lineWidth:1,fill:"#fff"},name:"collapse-icon"}),u},setState:function(t,e,n){if("collapsed"===t){var r=n.get("group").find((function(t){return"collapse-icon"===t.get("name")})),i=e?o.default.Marker.expand:o.default.Marker.collapse;r.attr("symbol",i)}}})}},function(t,e,n){"use strict";function r(t){return Array.isArray(t)&&t.length>0}function o(t,e){if(!t)return"";var n=/[^\x00-\xff]/g;if(t.replace(n,"mm").length<=e)return t;for(var r=Math.floor(e/2);r<t.length;r++)if(t.substr(0,r).replace(n,"mm").length>=e)return t.substr(0,r)+"...";return t}function i(t,e,n=[],r=0){const o=t._cfg.model;if(!o||void 0===o.fid)return;return function t(e,n,r){for(let o=0;o<r.length;o++){let i=r[o];const a=i._cfg.model.id,l=e._cfg.model.fid;if(a===l)return void n.push(i);i.children&&i.children.length>0&&t(e,n,i.children)}}(t,n,e),i(n[r],e,n,++r),n}n.r(e),n.d(e,"isArrayEmpty",(function(){return r})),n.d(e,"fittingString",(function(){return o})),n.d(e,"findAllParent",(function(){return i}))},function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.treeEdge=e.defaultEdgeStyle=e.flowLine=e.customCubicHorizontal=void 0;var o=r(n(0)),i=r(n(10));e.defaultEdgeStyle={stroke:"rgb(51, 153, 255)",endArrow:{path:"M 0,0 L 12, 6 L 9,0 L 12, -6 Z",fill:"rgb(51, 153, 255)",d:0}};e.customCubicHorizontal=function(){o.default.registerEdge("custom-cubic-horizontal",{curvePosition:[.5,.5],getControlPoints:function(t){var e=t.startPoint,n=t.endPoint;return void 0!==t.curvePosition&&(this.curvePosition=t.curvePosition),i.default(this.curvePosition)&&(this.curvePosition=[this.curvePosition,1-this.curvePosition]),[{x:(n.x-e.x)*this.curvePosition[0]+e.x,y:e.y},{x:(n.x-e.x)*this.curvePosition[1]+e.x,y:n.y}]}},"cubic")};e.flowLine=function(t){o.default.registerEdge("flow-line",{draw:function(t,e){var n=t.startPoint,r=t.endPoint,o=n.y===r.y?0:n.y>r.y?10:-10,i=t.style,a=(n.x+r.x)/2;return e.addShape("path",{attrs:{lineWidth:2,stroke:i.stroke,endArrow:i.endArrow,path:[["M",n.x,n.y],["L",a-10,n.y],["Q",a,n.y,a,n.y-o],["L",a,n.y-o],["L",a,r.y+o],["Q",a,r.y,a+10,r.y],["L",a+10,r.y],["L",r.x,r.y]]}})}})};e.treeEdge=function(){o.default.registerEdge("tree-edge",{draw:function(t,e){var n=!!t.targetNode.getModel().edgeError,r=t.startPoint,o=t.endPoint,i=this.getControlPoints(t),a=[r];i&&(a=a.concat(i)),a.push(o);var l=this.getPath(a),s=t.style;return e.addShape("path",{attrs:{path:l,lineWidth:12,stroke:n?"rgba(245,34,45,0.05)":"rgba(47,84,235,0.05)",opacity:0,zIndex:0},name:"line-bg"}),e.addShape("path",{attrs:{endArrow:s.endArrow,path:l,lineWidth:1,stroke:"#FAFAFA;",zIndex:1,lineAppendWidth:12},edgeError:!!n,name:"path-shape"})},afterDraw:function(t,e){},setState:function(t,e,n){},update:null},"cubic-horizontal")}},,,function(t){t.exports=JSON.parse('{"name":"nhc-tree-graph","version":"0.0.5","description":"a base in G6 tree graph module","main":"lib/index.min.js","scripts":{"test":"echo \\"Error: no test specified\\" && exit 1","dev":"webpack-dev-server","build":"webpack --env prod "},"devDependencies":{"autoprefixer":"^9.6.4","axios":"^0.19.2","clean-webpack-plugin":"^3.0.0","copy-webpack-plugin":"^5.0.4","css-loader":"^3.2.0","express":"^4.17.1","file-loader":"^4.2.0","html-webpack-plugin":"^3.2.0","node-sass":"^4.12.0","normalize.css":"^8.0.1","postcss-loader":"^3.0.0","sass-loader":"^8.0.0","style-loader":"^1.0.0","ts-loader":"^8.0.6","typescript":"^4.0.3","url-loader":"^2.2.0","webpack":"^4.44.2","webpack-cli":"^3.3.12","webpack-dev-middleware":"^3.7.2","webpack-dev-server":"^3.9.0"},"dependencies":{"@antv/g-base":"^0.5.1","@antv/g6":"^3.8.1","insert-css":"^2.0.0"},"browserslist":["> 1%","last 2 versions","not ie <= 8"],"publishConfig":{"registry":"https://nexus.alltosea.com/repository/nhc-npm-hosted/"},"repository":{"type":"git","url":"http://git.smart-info.cn:8999/ChrisChen/tree-graph.git"},"author":"ChrisChen","license":"ISC"}')}]).default}));